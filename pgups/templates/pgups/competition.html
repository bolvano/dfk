{% extends 'pgups/base.html' %}
{% load staticfiles %}
{% block content %}

<div class="container">
	<!-- Heading -->
	<div class="heading">
		<h1><b>{{competition.name}}</b></h2>
	</div> <!-- End of Heading -->

	{% if not competition.finished %}
		<!-- Requests -->
		<h2>Заявки</h2>
		<ul class="basic-list">
			{% for userrequest in competition.userrequest_set.all %}
				<li>
					<a href="../../userrequest/{{userrequest.id}}/">{{userrequest.date|date:"d.m.Y"}}: 
					{% if userrequest.team %}
						{{userrequest.team}}
					{% else %}
						индивидуальная заявка
					{% endif %}
					</a> {% if user.is_authenticated %} (Подтверждено {{userrequest.approved_competitors|length}}/{{userrequest.competitor_set.all|length}} ) {% endif %}
				</li>
			{% endfor %}
		</ul>
		<hr> <!-- End of Requests -->

		<!-- Teams -->
		<h2>Составы команд</h2>
		<ul class="basic-list">
			{% for team in teams %}
				<li>
					<a href="../../competition/team/{{competition.id}}/{{team.id}}/">{{team}}</a>
				</li>
			{% endfor %}
		</ul>
		<hr> <!-- End of Teams -->

		<!-- Tours -->
		<h2>Туры</h2>
		<ul class="basic-list">
			{% for tour in competition.tour_set.all %}
			{% if tour.competitor_set.all|length > 0 %}
				<li>
					<a href="../../tour/{{tour.id}}/">{{tour}}</a>
				</li>
			{% endif %}
			{% endfor %}
		</ul>
		<hr> <!-- End of Tours -->

		<div class="row">

			<div class="col-lg-3">
				<a class="btn btn-lg btn-success starts" href="../../competition/starts/{{competition.id}}/">
					<span>Текущая сетка стартов</span>
				</a>
			</div>

			{% if user.is_authenticated %}

				<div class="col-lg-3 col-lg-offset-6">
					<form action="." method="POST" >{% csrf_token %}
						<input type="hidden" name="competition_id" value="{{competition.id}}">
						<input type="hidden" name="close" value="1">
						<input type="submit" class="close-competition btn btn-lg btn-danger pull-right" value="Закрыть соревнования">
					</form>
				</div>

				<div class="col-lg-12">
					<form action="../../generate_starts/" method="POST" >{% csrf_token %}
						<input type="hidden" name="competition_id" value="{{competition.id}}">
						<input type="submit" class="generate-starts btn btn-lg btn-default" value="Перегенерировать старты">
					</form>
				</div>

				<div class="col-lg-12">
					<form action="../../generate_starts2/" method="POST" >{% csrf_token %}
						<input type="hidden" name="competition_id" value="{{competition.id}}">
						<input type="submit" class="generate-starts btn btn-lg btn-default" value="Перегенерировать старты (с разбивкой по возрастам)">
					</form>
				</div>

				<!-- <a class="pull-right btn btn-md btn-default" href="../../competition_starts_sort/{{competition.id}}/">Ручная настройка стартов</a> -->

			{% endif %}

		</div>

	{% else %}

	<div class="competition-menu">

		<p>
			<a class="btn btn-lg btn-primary" href="../../results/starts/{{competition.id}}/">Результаты по заплывам и дорожкам</a>
		</p>

		<p>
			<a class="btn btn-lg btn-primary" href="../../results/tours/{{competition.id}}/">Результаты по турам</a>
		</p>

		<p>
			<a class="btn btn-lg btn-primary" href="../../results/teams/{{competition.id}}/">Результаты по командам</a>
		</p>

		{% if user.is_authenticated %}
				<form action="." method="POST" >{% csrf_token %}
					<input type="hidden" name="competition_id" value="{{competition.id}}">
					<input type="hidden" name="close" value="0">
					<input type="submit" class="close-competition btn btn-lg btn-default" value="Редактировать результаты соревнований">
				</form>
		{% endif %}

	</div>

	{% endif %}

</div>

{% endblock %}