{% extends 'pgups/base.html' %}
{% load staticfiles %}
{% block content %}

	{% if user.is_authenticated %}

	<!-- Jumbotron -->
	<div class="jumbotron">
		<div class="container">
			<div class="row">
				<div class="col-md-11">

					<h1>Регистрация соревнований</h1><br>
					<p class="lead">Заполните форму, выбрав необходимые настройки.</p>

				</div>
			</div>
		</div>
	</div> <!-- End of Jumbotron -->

	<div ng-app="createCompetitionApp" ng-controller="CreationFormController as creation"> <!-- createCompetitionApp -->

	<input type="hidden" name="csrf_token" ng-init="csrf_token='{{csrf_token}}'" ng-model="csrf_token">

		<form name="creationForm" class="form-horizontal" role="form" novalidate> <!-- creationForm -->

			<div class="container">

				{$ creation.data $}

				{$ csrf_token $}

				<!-- Step 1 -->
				<div ng-show="creation.step === 1" class="animation-show-hide">

					<!-- Heading -->
					<div class="heading">
						<h2>Общая информация</h2>
					</div> <!-- End of Heading -->

					<div class="creation-form">

						<!-- Name -->
						<div class="form-group">
							<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="name">Название:</label>
							<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
								<input class="form-control" name="name" ng-model="creation.data.name" type="text" required/>
								<p class="error-block" ng-show="creationForm.name.$dirty && creationForm.name.$error.required">Введите название</p>
							</div>
						</div> <!-- End of Name -->

						<!-- Type -->
						<div class="form-group">
							<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="representative">Тип:</label>
							<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
								<select class="form-control" name="type" ng-model="creation.data.type" type="text" required/>
									<option value="0">детские</option>
									<option value="1">взрослые</option>
								</select>
								<p class="error-block" ng-show="creationForm.type.$dirty && requestForm.representative.$error.required">Выберите тип</p>
							</div>
						</div> <!-- End of Type -->

						<!-- Start date -->
						<div class="form-group">
							<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="name">Дата начала:</label>
							<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
								<input class="form-control" name="date_start" ng-model="creation.data.date_start" type="date" placeholder="2016-01-01" required/>
								<p class="error-block" ng-show="creationForm.date_start.$dirty && creationForm.date_start.$error.required">Введите дату начала соревнований</p>
								<p class="error-block" ng-show="creationForm.date_start.$dirty && creationForm.date_start.$error.date">Введите дату в формате 2016-01-01</p>
							</div>
						</div> <!-- End of Start date -->

						<!-- Finish date -->
						<div class="form-group">
							<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="name">Дата завершения:</label>
							<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
								<input class="form-control" name="date_finish" ng-model="creation.data.date_finish" type="date" placeholder="2016-01-01" required/>
								<p class="error-block" ng-show="creationForm.date_finish.$dirty && creationForm.date_finish.$error.required">Введите дату завершения соревнований</p>
								<p class="error-block" ng-show="creationForm.date_finish.$dirty && creationForm.date_finish.$error.date">Введите дату в формате 2016-01-01</p>
							</div>
						</div> <!-- End of Finish date -->

					</div>

					<div class="button-wrapper row">

						<button class="btn btn-lg btn-success pull-right col-lg-2" ng-click="creation.nextStep()" ng-disabled="false">
							Продолжить <span class="glyphicon glyphicon-chevron-right"></span>
						</button>

					</div>

				</div> <!-- End of Step 1 -->

				<!-- Step 2 -->
				<div ng-show="creation.step === 2" class="animation-show-hide">

					<!-- Heading -->
					<div class="heading">
						<h2>Выберите возрастные группы, стили и дистанции</h2>
					</div> <!-- End of Heading -->

					<div class="row"> <!-- Row -->

						<!-- Age groups -->
						<div class="col-lg-4 col-md-4">

							<h3>Возрастные группы</h3>

							<div class="checkbox" ng-repeat="group in creation.fetchedData.ages">
								<label>
									<input type="checkbox" value="{$ group.id $}" ng-model="group.selected" ng-disabled="creation.data.type == group.kids"> {$ group.name $}
								</label>
							</div>

						</div> <!-- End of Age groups -->

						<!-- Styles -->
						<div class="col-lg-4 col-md-4">

							<h3>Стили</h3>

							<div class="checkbox" ng-repeat="style in creation.fetchedData.styles | orderBy: 'name'">
								<label>
									<input type="checkbox" value="{$ style.id $}" ng-model="style.selected"> {$ style.name $}
								</label>
							</div>

						</div> <!-- End of Styles -->

						<!-- Distances -->
						<div class="col-lg-4 col-md-4">

							<h3>Дистанции</h3>

							<div class="checkbox" ng-repeat="distance in creation.fetchedData.distances">
								<label>
									<input type="checkbox" value="{$ distance.id $}" ng-model="distance.selected"> {$ distance.name $}
								</label>
							</div>

						</div> <!-- End of Distances -->

					</div> <!-- End of row -->

					<div class="button-wrapper row">

						<button class="btn btn-lg btn-danger pull-left col-lg-2" ng-click="creation.prevStep()">
							<span class="glyphicon glyphicon-chevron-left"></span> Вернуться
						</button>

						<button class="btn btn-lg btn-success pull-right col-lg-2" ng-click="creation.nextStep(); creation.generateTours();">
							Продолжить <span class="glyphicon glyphicon-chevron-right"></span>
						</button>

					</div>

				</div> <!-- End of Step 2 -->

				<!-- Step 3 -->
				<div ng-show="creation.step === 3" class="animation-show-hide">

					<!-- Heading -->
					<div class="heading">
						<h2>Выберите туры</h2>
					</div> <!-- End of Heading -->

					<div class="checkbox">
						<label>
							<input type="checkbox" ng-model="creation.selectedAll" ng-click="creation.selectAll()"> <b>Выбрать все</b>
						</label>
					</div>

					<br>

					<div class="checkbox tour-{$ tour.age $}" ng-repeat="tour in creation.tours">
						<label>
							<input type="checkbox" value="{$ tour.id $}" ng-model="tour.selected" ng-click="creation.checkIfAllSelected()"> {$ tour.name $}
						</label>
					</div>

					<div class="button-wrapper row">

						<button class="btn btn-lg btn-danger pull-left col-lg-2" ng-click="creation.prevStep()">
							<span class="glyphicon glyphicon-chevron-left"></span> Вернуться
						</button>

						<button class="btn btn-lg btn-success pull-right col-lg-3" ng-click="creation.nextStep(); creation.groupTours(creation.selectedTours())">
							Продолжить <span class="glyphicon glyphicon-chevron-right"></span>
						</button>

					</div>

				</div> <!-- End of Step 3 -->

				<!-- Step 4 -->
				<div ng-show="creation.step === 4" class="animation-show-hide">

					<!-- Heading -->
					<div class="heading">

						<h2>
							{$ creation.data.name $}<br>
							({$ creation.data.date_start | date:'dd.MM.yyyy' $} &ndash; {$ creation.data.date_finish | date:'dd.MM.yyyy' $})
						</h2>

						<h3>
							<span ng-if="creation.data.type === '0'">Детские соревнования</span>
							<span ng-if="creation.data.type === '1'">Взрослые соревнования</span>
						</h3>

					</div> <!-- End of Heading -->

					<h3 class="small-heading">Список туров:</h3>

					<div>
						<ul class="basic-list">
							<li class="tour-{$ tour.age $}" ng-repeat="tour in creation.selectedTours()">{$ tour.name $}
						</ul>
					</div>

					<div class="button-wrapper row">

						<button class="btn btn-lg btn-danger pull-left col-lg-2" ng-click="creation.prevStep()">
							<span class="glyphicon glyphicon-chevron-left"></span> Вернуться
						</button>

						<button id="create-competition-button" class="btn btn-lg btn-success pull-right col-lg-3" ng-click="creation.submitForm()">
							Создать соревнования <span class="glyphicon glyphicon-ok"></span>
						</button>

					</div>

				</div> <!-- End of Step 3 -->

			</div> <!-- End of container -->

		</form> <!-- End of creationForm -->

	</div> <!-- End of createCompetitionApp -->

	{% else %}

	<div class="container">
		<h3 style="margin-top: 20%">
			<span style="font-size: larger" class="alt-color glyphicon glyphicon-alert"></span> Для просмотра этой страницы необходимо залогиниться.
		</h3>
	</div>

	{% endif %}

{% endblock %}

{% block additionaljs %}

	<script src="https://code.angularjs.org/1.4.9/angular-animate.min.js"></script> <!-- Angular animations -->
	<script src="{% static 'js/create-competition-app.js' %}"></script> <!-- Competition reg App -->

{% endblock %}
