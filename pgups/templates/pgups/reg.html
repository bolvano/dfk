{% extends 'pgups/base.html' %}
{% load staticfiles %}
{% block content %}

	<!-- Jumbotron -->
	<div class="jumbotron">
		<div class="container">
			<div class="row">
				<div class="col-md-11">
					<h1>Техническая заявка на участие в соревнованиях по плаванию</h1><br>
					<p class="lead">Пожалуйста, внимательно заполните заявку. Укажите имена и фамилии участников, год рождения,
				основную и при необходимости дополнительную дистанцию, а также предварительное время.</p>
					<p><i>Все поля, кроме специально отмеченных, обязательны для заполнения.</i></p>
				</div>
			</div>
		</div>
	</div> <!-- End of Jumbotron -->

	<br>

	<div ng-app="validationApp" ng-controller="formCtrl">

		<!-- Request form -->
		<form name="requestForm" class="request-form form-horizontal" role="form" novalidate>

			<div class="container">

				<!-- Well -->
				<div class="well row">
					<div class="col-md-7 col-xs-12">
						<h3>Заявитель</h3><br>
						<p>Если заявка индивидуальная, оставьте поле "Команда" пустым.</p><br>
					</div>
				</div> <!-- End of well -->

				<br>

				<div class="request-form">

					<!-- Competition -->
					<div class="form-group">
						<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="competition">Соревнования:</label>
						<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
							<select class="form-control" name="competition" ng-model="form.competition" required>
								<option value="" selected="selected">Выберите соревнование из списка:</option>
								<option value="2">Брюквота</option>
							</select>
							<p class="error-block" ng-show="requestForm.competition.$dirty && requestForm.competition.$invalid">Выберите соревнование</p>
						</div>
					</div> <!-- End of Competition -->

					<!-- Team -->
					<div class="form-group">
						<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="team">Команда (необязательно):</label>
						<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
							<select class="form-control" name="team" ng-model="form.team" ng-change="clearPersons()">
								<option value="" selected="selected">Выберите команду:</option>
								<option value="1">ДФК</option>
								<option value="2">MEVIS</option>
								<option value="3">МТС</option>
							</select>
						</div>
					</div> <!-- End of Team -->

					<!-- Representative -->
					<div class="form-group">
						<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="representative">Заявитель/Представитель команды:</label>
						<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
							<input class="form-control" name="representative" ng-minlength="2" ng-model="form.representative" ng-model-options="{ updateOn: 'blur' }" type="text" required/>
							<p class="error-block" ng-show="requestForm.representative.$dirty && requestForm.representative.$error.required">Введите имя заявителя</p>
							<p class="error-block" ng-show="requestForm.representative.$dirty && requestForm.representative.$error.minlength">Слишком короткое имя</p>
						</div>
					</div> <!-- End of Representative -->

					<!-- Phone -->
					<div class="form-group">
						<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="phone">Телефон:</label>
						<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
							<input class="form-control" name="phone" ng-model="form.phone" ng-model-options="{ updateOn: 'blur' }" type="text" required/>
							<p class="error-block" ng-show="requestForm.phone.$dirty && requestForm.phone.$error.required">Введите номер телефона</p>
						</div>
					</div> <!-- End of Phone -->

					<!-- Email -->
					<div class="form-group">
						<label class="col-lg-4 col-md-4 col-sm-5 col-xs-12 control-label text-left" for="email">Электронная почта:</label>
						<div class="col-lg-5 col-md-5 col-sm-7 col-xs-12">
							<input class="form-control" name="email" ng-model="form.email" ng-model-options="{ updateOn: 'blur' }" type="email" placeholder="mail@example.ru" required/>
							<p class="error-block" ng-show="requestForm.email.$dirty && requestForm.email.$error.required">Введите адрес электронной почты</p>
							<p class="error-block" ng-show="requestForm.email.$dirty && requestForm.email.$error.email">Неверный формат электронной почты</p>
						</div>
					</div> <!-- End of Email -->

				</div>

			</div>

		</form> <!-- End of Request form -->

		<div class="container">

			<!-- Well -->
			<div class="well row">
				<div class="col-md-7 col-xs-12">
					<h3>Участники</h3><br>
					<p>Если заявка командная, добавьте участников команды, если индивидуальная - то только себя.
					Первая указанная дистанция идёт в зачёт. Для каждого участника будет учитываться только одна основная и одна дополнительная (по желанию) дистанция.
					</p>
				</div>
			</div> <!-- End of well -->

			<!-- Person form -->
			<form class="person-form" name="personsForm" role="form" novalidate>

				<!-- Persons -->
				<div class="row" ng-repeat="person in persons">

					<hr><br>

					<ng-form name="personForm">

						<div class="col-lg-5 col-md-4 col-sm-8 col-xs-12">

							<!-- First name -->
							<div class="form-group row">
								<label class="col-lg-4 col-md-4 col-sm-4 col-xs-12 control-label text-left" for="first_name">Имя:</label>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
									<input class="form-control" maxlength="255" name="first_name" ng-model="person.first_name" type="text" required/>
									<p class="error-block" ng-show="personForm.first_name.$dirty && personForm.first_name.$error.required">Введите имя участника</p>
								</div>
							</div> <!-- End of First name -->

							<!-- Last name -->
							<div class="form-group row">
								<label class="col-lg-4 col-md-4 col-sm-4 col-xs-12 control-label text-left" for="last_name">Фамилия:</label>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
									<input class="form-control" maxlength="255" name="last_name" ng-model="person.last_name" type="text" required/>
									<p class="error-block" ng-show="personForm.last_name.$dirty && personForm.last_name.$error.required">Введите фамилию участника</p>
								</div>
							</div> <!-- End of Last name -->

							<!-- Birth year -->
							<div class="form-group row">
								<label class="col-lg-4 col-md-4 col-sm-4 col-xs-12 control-label text-left" for="birth_year">Год рождения:</label>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
									<select class="form-control" name="birth_year" ng-model="person.birth_year" ng-options="year for year in years" required>
									</select>
									<!--<p class="error-block" ng-show="personForm.birth_year.$dirty && personForm.birth_year.$error.required">Это обязательное поле</p>-->
								</div>
							</div> <!-- End of Birth year -->

							<!-- Gender -->
							<div class="form-group row">
								<label class="col-lg-4 col-md-4 col-sm-4 col-xs-12 control-label text-left" for="gender">Пол:</label>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
									<select class="form-control" name="gender" ng-model="person.gender" required>
										<option value="М">М</option>
										<option value="Ж">Ж</option>
									</select>
									<!--<p class="error-block" ng-show="personForm.gender.$dirty && personForm.gender.$error.required">Это обязательное поле</p>-->
								</div>
							</div> <!-- End of Gender -->

						</div>

						<!-- Buttons -->
						<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">
							<a id="remove-person-{$ person.personId $}" href="#" class="btn btn-danger btn-md btn-block" ng-click="removePerson($index)">Удалить участника</a>
							<a id="add-competitor-{$ person.personId $}" href="#" class="btn btn-success btn-md btn-block" ng-click="addCompetitor($index)">Добавить заплыв</a>
						</div>

						<!-- Competitors -->
						<div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">

						<div ng-repeat="competitor in person.competitors">

							<div class="row single-competitor">

								<ng-form name="competitorForm">

									<div class="col-lg-10 col-md-10 col-sm-8 col-xs-12">

										<!-- Tour -->
										<div class="form-group row">

											<label class="col-md-2 control-label text-left" for="tour">Тур:</label>

											<div class="col-md-10">

												<select class="form-control" name="tour" ng-model="competitor.tour" required>
													<option value="" selected="selected">Выберите тур из списка:</option>
													<option value="example_tour">Example Tour</option>
												</select>

												<p class="error-block" ng-show="competitorForm.tour.$dirty && competitorForm.tour.$error.required">Выберите тур из списка</p>

											</div>

										</div> <!-- End of Tour -->

										<!-- Prior time -->
										<div class="form-group row">

												<label class="col-md-2 control-label text-left" for="prior_time">Время:</label>

												<div class="col-md-10">

													<input class="form-control" min="0" name="prior_time" ng-model="competitor.prior_time" type="number" step="0.01" placeholder="0,00" required/>

													<p class="error-block" ng-show="competitorForm.prior_time.$dirty && competitorForm.prior_time.$error.required">Введите предварительное время</p>
													<p class="error-block" ng-show="competitorForm.prior_time.$dirty && competitorForm.prior_time.$error.number">Введите время в секундах в формате <i>10,00</i></p>
													<!--<p class="error-block" ng-show="competitorForm.prior_time.$dirty && competitorForm.prior_time.$error.maxlength">Округлите время до сотых</p>-->
													<p class="error-block" ng-show="competitorForm.prior_time.$dirty && competitorForm.prior_time.$error.min">Время не может быть отрицательным!</p>
												</div>

										</div> <!-- End of Prior time -->

										<!-- Main distance -->
										<div class="col-lg-10 col-lg-offset-2 col-md-10 col-sm-8 col-xs-12" ng-show="competitor.competitorId === 'competitor-0'">
											<p class="note"><i><b>* основная дистанция</b></i></p>
										</div> <!-- End of Main distance -->

									</div>

									<!-- Remove competitor -->
									<div class="col-lg-2 col-md-2 col-sm-8 col-xs-12 ">
										<a href="#" class="remove-competitor-{$ competitor.competitorId $} remove-competitor-btn btn btn-danger btn-sm" ng-click="removeCompetitor($parent.$index, $index)"><span class="glyphicon glyphicon-remove"></span></a>
									</div> <!-- End of Remove competitor -->

								</ng-form>

							</div>

						</div>

						</div> <!-- End of Competitors -->

					</ng-form>

				</div> <!-- End of Persons -->

			</form> <!-- End of Person form -->

			<hr>

			<!-- Add person button -->
			<button id="add-person-button" href="#" class="add-person-button btn btn-default btn-lg" ng-click="addPerson()" ng-disabled="indRequestOnePerson && (form.team === undefined || form.team === '')">Добавить участника</button>

			<br>

		</div> <!-- End of container -->

			<!-- Jumbotron -->
			<div class="jumbotron">
				<div class="container">

					{$ form $}

					<div class="row">
						<div class="col-lg-3 col-md-4 col-sm-5 col-xs-6 col-centered">

							<button type="submit" class="btn btn-success btn-xxl" ng-disabled="requestForm.$invalid || personsForm.$invalid" ng-click="submitRequest()">Отправить заявку</button>

								<!--
									<script src="{% static 'js/notie.js' %}"></script>
									<script> notie.alert(1, 'Заявка сохранена!', 2.5); </script> 
								Notie -->

						</div>
					</div>
				</div>
			</div> <!-- End of jumbotron -->

	</div> <!-- End of validationApp -->

{% endblock %}
